import asyncio

from aiogram import Router, F
from aiogram.types import Message

from config import bot, admin_group, users_data_repo, teacher_thread, parent_thread, pupil_thread
from phrases import LAST_STAND
from src.keyboards.pupil_keyboard import event_info_keyboard
from src.keyboards.user_keyboards import role_buttons
from src.states.user_states import User

last_stand_router = Router()


async def db_checker(message: Message):
    #if message.text == role_buttons['teacher']:
        #message_thread = teacher_thread
    if message.text == role_buttons['parent']:
        message_thread = parent_thread
    elif message.text == role_buttons['pupil']:
        message_thread = pupil_thread
    else:
        message_thread = 0

    user_data = users_data_repo.get_user_by_chat_id(message.chat.id)
    user_data = user_data.data[0]
    adm_mes = await bot.send_message(
        chat_id=admin_group,
        message_thread_id=message_thread,
        text=f"(–ü—Ä–æ—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {message.chat.id} - @{message.from_user.username}"
             f"\n–§–ò–û: {user_data['name']}"
             f"\n–†–æ–ª—å: {message.text}"
             f"\n–¢–µ–ª–µ—Ñ–æ–Ω: +{user_data['tg_phone']}",
    )
    users_data_repo.update_field(message.chat.id, "message", adm_mes.message_id)


@last_stand_router.callback_query(User.end)
async def handle_event_end(call: Message):
    event_dict = {
        "e_1": """<b>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è Python –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ 8-11 –∫–ª–∞—Å—Å–æ–≤</b>

üìç <b>–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</b> –ù–∞ –±–∞–∑–µ –≤–∞—à–µ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è

üéØ <b>–ß—Ç–æ –ø–æ–ª—É—á–∏—Ç —É—á–∞—Å—Ç–Ω–∏–∫:</b>

üî• –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ —è–∑—ã–∫—É Python —Å –Ω—É–ª—è

üë®‚Äçüè´ –ó–∞–Ω—è—Ç–∏—è —Å —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏

üíº –ü—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –æ—Ç IT-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ (frontend/backend)

üéÆ –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

üìÇ –ì–æ—Ç–æ–≤–æ–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –¥–ª—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è

üìú –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (—Å —Ñ–∏–∫—Å–∞—Ü–∏–µ–π –Ω–∞ –ì–æ—Å—É—Å–ª—É–≥–∞—Ö)

üíé –î–æ 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –∫ –ï–ì–≠

ü§ù –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ –≤ IT-—Å—Ç—É–¥–∏–∏ Botoforge

üéØ –í–Ω–µ—É—á–µ–±–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: –∫–≤–µ—Å—Ç—ã, –ø–µ–π–Ω—Ç–±–æ–ª, –ª–∞–∑–µ—Ä—Ç–∞–≥

üìÖ <b>–§–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è:</b>

–û—á–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è 2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é

–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å—É–µ—Ç—Å—è —Å–æ —à–∫–æ–ª–æ–π

–ì—Ä—É–ø–ø—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ —É—Ä–æ–≤–Ω—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏

‚ùó <b>–í–∞–∂–Ω–æ:</b>

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç —Å—Ç—Ä–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ

–£—á–∞—Å—Ç–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

üëâ <b>–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è</b>: –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∏–∂–µ""",


        "e_2": """–ö–æ–º–ø–∞–Ω–∏—è –°–±–µ—Ä –∏ –∫–∞—Ñ–µ–¥—Ä–∞ –ü–ú–∏–§–ò –û–º–ì–¢–£ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–∞ –º–∞—Å—à—Ç–∞–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥–Ω—ã–µ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è. –ö–µ–π—Å—ã –ø–æ –±–æ–ª—å—à–∏–º —è–∑—ã–∫–æ–≤—ã–º –º–æ–¥–µ–ª—è–º –∏ —Ñ–∏—Ä–º–µ–Ω–Ω–æ–º—É –ø—Ä–æ–¥—É–∫—Ç—É ¬´–ù–∞–≤–∏–≥–∞—Ç–æ—Ä BI¬ª –æ—Ç –°–±–µ—Ä–∞, –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —É—á–∞—Å—Ç–∏—è, —ç–∫—Å–ø–µ—Ä—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –∫—Ä—É—Ç—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º –∏ –ø—Ä–∏–∑—ë—Ä–∞–º ‚Äì —ç—Ç–æ –ª–∏—à—å —á–∞—Å—Ç—å –ø—Ä–∏—á–∏–Ω –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Å–∏–ª—ã. –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –º–æ–≥—É—Ç —Å—Ç—É–¥–µ–Ω—Ç—ã –ª—é–±—ã—Ö —É—á—Ä–µ–∂–¥–µ–Ω–∏–π –≤—ã—Å—à–µ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.

23 –º–∞—è –≤ 15:00 - 26 –º–∞—è –≤ 11:00, –û–º–ì–¢–£ (–ø—Ä-–∫—Ç –ú–∏—Ä–∞, –¥. 11)

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:""",


        "e_3": """–°–∞–º–æ–µ –º–∞—Å—à—Ç–∞–±–Ω–æ–µ –ò–¢-–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –û–º—Å–∫–∞ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –∏ –º–ª–∞–¥—à–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤. –•–∞–∫–∞—Ç–æ–Ω, –ø–æ—Å–≤—è—â—ë–Ω–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Å–∞–π—Ç–æ–≤ –∏ –±–æ—Ç–æ–≤. –ö–∞–∂–¥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å –æ–ø—ã—Ç —Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á, –ø–æ—Å–ª—É—à–∞—Ç—å –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –∫—Ä—É—Ç—ã—Ö —Ä–µ–±—è—Ç –∏ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è–º–∏ –ò–¢-—Å–æ–æ–±—â–µ—Å—Ç–≤–∞. –ö–µ–π—Å—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –º–æ–∂–Ω–æ –Ω–µ –∏–º–µ—è –Ω–∞–≤—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

2 –º–∞—è –≤ 14:00 - 4 –º–∞—è –≤ 17:00, –¢–æ—á–∫–∞ –∫–∏–ø–µ–Ω–∏—è –û–º—Å–∫ (—É–ª. –ú–∞—Ä—à–∞–ª–∞ –ñ—É–∫–æ–≤–∞, –¥. 21)

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:""",


        "e_4": """–ò–∑—É—á–∏–º –æ—Å–Ω–æ–≤—ã Scrum –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏. –†–∞–∑–±–µ—Ä—ë–º—Å—è, –∫–∞–∫ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏–∑–º–µ–Ω—è—é—â–∏—Ö—Å—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö. –£–¥–µ–ª–∏–º –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã: –∫–∞–∫ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª—é–¥–µ–π, —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –¥–æ–≤–µ—Ä–∏—è. –ü—Ä–æ–∫–∞—á–∞–µ–º –Ω–∞–≤—ã–∫–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, –Ω–∞—É—á–∏–º—Å—è –≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, –∑–∞–∫–∞–∑—á–∏–∫–∞–º–∏ –∏ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–∞–º–∏.

17 –º–∞—è –≤ 15:00 - 18 –º–∞—è –≤ 20:00, –¢–æ—á–∫–∞ –∫–∏–ø–µ–Ω–∏—è –û–º—Å–∫ (—É–ª. –ú–∞—Ä—à–∞–ª–∞ –ñ—É–∫–æ–≤–∞, –¥. 21)

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:""",
    }

    url_dict = {
        "e_1": "https://docs.google.com/forms/d/e/1FAIpQLSfbcCJGJRqBQaNE6YklC4lh7sak_Bx3LKDdyDc62uVtpLEP3w/viewform",
        "e_2": "https://aibi.pmifi.ru/",
        "e_3": "https://leader-id.ru/events/550454",
        "e_4": "https://leader-id.ru/events/542373",
    }

    await bot.send_message(
        chat_id=call.from_user.id,
        text=event_dict[call.data],
        reply_markup=event_info_keyboard("‚ùóÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚ùó", url_dict[call.data]),
        parse_mode="HTML"
    )





@last_stand_router.message(F.chat.id != admin_group)
async def handle_last_stand(message: Message):
    chat_id = message.chat.id
    await bot.send_message(
        chat_id=chat_id,
        text=LAST_STAND
    )

